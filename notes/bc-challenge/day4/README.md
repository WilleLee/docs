# Boostcamp Challenge Day 4: 프로세스 메모리의 구조와 관리

이번 학습 정리에서는 메모리 관리에 대해 Deepu Sasidharan가 연재한 글들의 일부를 요약/번역 및 정리하였다.

## [모던 프로그래밍 언어에서의 메모리 관리 해부](https://deepu.tech/memory-management-in-programming/)

본 시리즈물은 메모리 관리의 이면에 있는 개념들을 해석하고 몇 가지 모던 프로그래밍 언어에서의 메모리 관리에 대해 깊이 알아보는 것을 목표로 한다. (...) 우리가 코드를 작성하는 방식이 언어가 자동으로 메모리를 관리하는 기술과는 관련 없이 메모리 관리에 영향을 미친다는 의미에서, 이러한 지식을 학습하는 것은 보다 좋은 성능의 코드를 작성하는 데 도움이 된다.

### 파트 1: 메모리 관리 입문

메모리 관리란 소프트웨어가 컴퓨터 메모리에 접근하는 방식을 제어하는 과정이다.

#### 메모리 관리란?

컴퓨터의 특정 운영 체제에서 실행되기 위해, 소프트웨어는 아래와 같은 목적에서 컴퓨터의 RAM(Random-access memory)에 접근할 수 있어야 한다.

- 실행되어야 할 **바이트코드**를 로드하기 위해
- 실행 중인 프로그램이 사용하는 **데이터 값**과 **데이터 구조**를 저장하기 위해
- 프로그램 실행을 위해 필요한 **런타임 시스템**을 로드하기 위해

소프트웨어 프로그램이 메모리를 사용할 때에는 바이트코드를 로드하기 위한 공간 외에도 두 가지 추가적인 메모리 구역, 즉 **스택**과 **힙** 메모리가 필요하다.

##### 스택 (Stack)

스택은 **정적 메모리 할당**에 사용되며, 이름이 보여주듯 선입선출(FILO) 방식으로 데이터를 저장한다.

- 단순히 블록의 최정상에 데이터를 쌓고 검색하므로, 스택에 데이터를 저장/검색하는 과정은 **아주 빠르다**.
- 하지만 그렇기 때문에 스택에 저장되는 데이터는 모두 **유한하고 정적**이어야 한다(데이터의 크기는 컴파일 시점에 알려진다).
- 이러한 스택에는 함수의 실행 데이터가 **스택 프레임**(stack frames)이라는 형태로 저장된다. 각 프레임은 해당 함수가 필요로 하는 데이터가 저장되는 블록 공간이다. 가령 어떤 함수가 새로운 변수를 선언할 때마다 새로운 스택 프로에미이 스택의 최정상에 "푸시"된다. 그러면 함수가 종료될 때마다 최정상 블록은 제거되고, 따라서 해당 함수에 의해 스택에 푸시된 모든 변수들은 제거된다. 이는 모두 여기에 저장된 데이터들이 정적이라는 점에서 컴파일 시점에 결정될 수 있다.
- **멀티 스레드 어플리케이션**(multi-threaded applications)은 **각 스레드마다 하나의 스택**(stack per thread)을 가질 수 있다.
- 스택의 메모리 관리는 **간단하고 직선적**(simple and straightforward)이며, 운영체제에 의해 수행된다.
- 스택에는 일반적으로 아래와 같은 데이터들이 저장된다.
  - **로컬 변수**(값 타입, 프리미티브, 프리미티브 상수)
  - **포인터들**
  - **함수 프레임**
- 힙과 달리 스택은 그 크기가 제한되어 있으므로 **스택 오버플로우**(stack overflow) 에러가 발생할 수 있다.
- 대부분의 언어에서는 스택에 저장될 수 있는 값의 **크기가 제한**되어 있다.

> **primitives**
>
> basic data types that are built into a programming language

##### 힙(Heap)

힙은 **동적 메모리 할당**에 사용되며, 스택과는 다르게 프로그램이 힙에 저장된 데이터를 확인하기 위해서는 **포인터**를 사용해야 한다.

- 데이터의 탐색이 스택보다 **더 느리다**. 하지만 스택보다 더 많은 데이터를 저장할 수 있다.
- 힙에는 **동적인 크기의** 데이터를 저장할 수 있다.
- 힙 메모리는 어플리케이션의 여러 스레드에 의해 **공유**될 수 있다.
- 동적이라는 점에서 힙은 **관리하기가 보다 까다롭고**, 대부분의 메모리 관리 상의 이슈가 여기에서 발생한다. 이런 이유로 각 언어마다 자동화된 메모리 관리 솔루션이 존재한다.
- 힙에는 일반적으로 아래와 같은 데이터들이 저장된다.
  - **전역 변수**
  - **참조 타입**
- 만약 어플리케이션이 할당된 힙보다 더 많은 메모리를 사용하려 하면, **아웃 오브 메모리**(out of memory) 에러가 발생할 수 있다.
- 일반적으로 힙에 저장되는 값에는 **크기 제한이 없다**. 물론 어플리케이션에게 얼마나 많은 메모리가 할당되는가에 대한 상한선은 존재한다.

#### 메모리 관리의 중요성

하드 디스크 드라이브들과 달리 RAM은 무한하지 않다. 만약 프로그램이 메모리를 해제하지 않고 계속해서 소비한다면, 결국에는 남은 메모리가 없게 되고, 프로그램이 오류를 일으키거나, 더 나쁜 경우에는 운영 체제 전체가 다운될 수 있다. (...) 따라서 대부분의 프로그래밍 언어는 소프트웨어 개발자가 메모리를 직접 관리하도록 하기보다는, 자동화된 메모리 관리 솔루션을 제공한다. 또한 메모리 관리를 얘기할 때 이는 대부분의 경우 힙 메모리 관리를 의미한다.

<!--
#### 다른 접근법?

(...) 몇몇 오래된 언어들은 여전히 개발자가 수동으로 메모리 관리를 설정하기를 요구하지만, 많은 경우는 그와 다르다. 어떤 언어들은 메모리 관리의 둘 이상의 접근법을 사용하며, 또 어떤 것들은 심지어 더 나은 것을 선택할 수 있도록 한다(C++). 이런 접근법은 아래와 같이 범주화할 수 있다.

##### 수동 메모리 관리

##### 가비지 컬렉션(Garbage Collection)
-->

## [V8 엔진 메모리 관리의 시각화](https://deepu.tech/memory-management-in-v8/)
