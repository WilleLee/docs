# 라우팅

## 라우팅 펀더멘탈

모든 어플리케이션의 골자는 라우팅이다.

#### 주요 개념들

- 트리 : 계층적 구조를 시각화하기 위한 하나의 약속.
- 서브트리 : 새로운 루트에서 시작하여 리프에서 끝나는, 트리의 일부분.
- 루트 : 트리 또는 서브트리의 첫 번째 노드. e.g. root layout
- 리프 : 자식을 갖지 않는 서브트리의 노드들.
- URL 세그먼트 : /로 구분된 URL의 일부분.
- URL 경로 : URL 세그먼트들의 합.

#### 앱 라우터

넥스트 버전 13에서 소개된 앱 라우터는 리액트 서버 컴포넌트를 기반으로 하며, 레이아웃의 공유, 네스티드 라우팅, 로딩 상태, 에러 핸들링 등을 지원한다.  
앱 라우터는 app 디렉터리 안에서 작동한다. app 디렉터리 내의 컴포넌트들은 모두 기본적으로 리액트 서버 컴포넌트이므로, 퍼포먼스 최적화, 서버 컴포넌트 사용성 등에서 이점을 가진다.

#### 폴더와 파일의 역할

넥스트는 파일 시스템에 기반한 라우터를 이용한다.

- **폴더들**은 라우트를 정의하는 데 이용된다. 하나의 라우트는 네스팅된 폴더들 사이 하나의 경로이며, 루트 폴더에서 시작하여 page.js 파일을 갖는 마지막 리프 폴더까지 이어지는 파일 시스템 계층 구조를 따른다.
- **파일들**은 각 라우트 세그먼트에서 보여지는 UI를 생성하는 데 이용된다.

#### 라우트 세그먼트

하나의 라우트 내의 각 폴더는 하나의 라우트 세그먼트를 나타낸다. 각 라우트 세그먼트는 URL 경로 상에서 일치하는 세그먼트와 연결된다.

![route segments](https://nextjs.org/_next/image?url=%2Fdocs%2Fdark%2Froute-segments-to-path-segments.png&w=3840&q=75&dpl=dpl_DyNfXwC3D1n6XsQpQvXsQ3g8fPYu)

#### 네스티드 라우트

폴더를 다른 폴더로 감싸면 하나의 네스티드 라우트가 생성된다. 가령 /dashboard/settings라는 라우트를 추가하려면 app 디렉터리에 dashboard 폴더를 생성하고, 그 안에 settings 폴더를 생성하면 된다.

#### 파일 컨벤션

넥스트는 특별한 파일 이름 컨벤션을 제공하며, 이를 통해 특정 동작을 수행하는 UI를 생성할 수 있다.

- layout.js : 하나의 세그먼트와 그 자식 세그먼트들이 공유하는 UI를 생성한다.
- page.js : 하나의 라우트 세그먼트에 대하여 유니크한 UI를 생성하여 해당 라우트가 외부에서 접근 가능하도록 한다.
- loading.js : 하나의 세그먼트와 그 자식 세그먼트들이 공유하는 로딩 UI를 생성한다.
- not-found.js : 하나의 세그먼트와 그 자식 세그먼트들이 공유하는 404 UI를 생성한다.
- global-error.js : 전역 에러 핸들링을 위한 UI를 생성한다.
- route.js : 서버 사이드 API 엔드포인트를 생성한다.
- template.js : 하나의 세그먼트와 그 자식 세그먼트들이 공유하는 UI를 생성하는데, 리렌더링되는 UI에 특화된다.
- default.js : 평행 라우트를 위한 fallback UI를 생성한다.

#### 컴포넌트 계층

하나의 라우트 세그먼트에서 위 파일 컨벤션에 따라 정의된 특별한 컴포넌트들은 특정 계층에서 렌더링된다.

![component hierarchy](https://nextjs.org/_next/image?url=%2Fdocs%2Fdark%2Ffile-conventions-component-hierarchy.png&w=3840&q=75&dpl=dpl_DyNfXwC3D1n6XsQpQvXsQ3g8fPYu)

하나의 네스티드 라우트에서 한 라우트 세그먼트의 컴포넌트들은그 부모 세그먼트의 컴포넌트들 안에 네스팅된다.

#### 동일 장소 배치

특별 파일들에 더불어, components, styles, tests 등 같은 커스텀 파일들 또한 app 디렉터리 내 폴더 안에서 동일 장소 배치될 수 있다. 이는 각 폴더가 라우트 세그먼트를 정의하기는 하지만, page.js, route.js 파일을 갖는 폴더만이 외부에서 접근 가능한 주소로 인식되기 때문이다.

#### 고급 라우팅 패턴

앱 라우터는 보다 진전된 라우팅 패턴들을 지원하기 위한 컨벤션들도 제공한다.

- 평행 라우트 : 동일 뷰에 대하여 둘 이상의 페이지들을 동시에 보여준다.
- 간섭 라우트 : ???

## 라우트 정의하기
